<!DOCTYPE html>
<html>
<head>
<meta name = 'viewport' content = 'width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable=0'>
<title>Liang</title>
<link rel="stylesheet" href="style.css">
<script
  src="https://code.jquery.com/jquery-3.6.0.slim.js"
  integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
  crossorigin="anonymous"></script>
<script type='text/javascript'>
var websock;
function start()
{
/*  if (websock) {
    websock.close();
  }*/

  websock = new WebSocket('ws://' + window.location.hostname + '/ws');
  websock.onopen = function(evt) { console.log('websock open'); };
  websock.onclose = function(e) {
    console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
    websock = undefined;
    setTimeout(function() {
      start();
    }, 1000);
  };

  websock.onerror = function(err) {
    console.error('Socket encountered error: ', err.message, 'Closing socket');
    websock.close();
  };  
  websock.onmessage = function(evt) {

    let parts = evt.data.split(";");

    if (parts[0] === "l") {
      let el = $("#log")
      el.append(`<p class='log-row'>${parts[1]}</p>`);
      el[0].scrollTop = el[0].scrollHeight;
    } else {
      $(`#${parts[0]}`).text(parts[1]);
    }
  };
}
function buttonclick(e)
{
  websock.send(e.id);
}

function sendCommand(component, value) {
  /*if (!websock) {
    start();
  }*/
  let msg = `${component}_${value}`;
  console.log(msg);
  websock.send(msg);
}

</script>
</head>
<body onload='javascript:start();'>
  <div class='container'> 
    <h1>Liang</h1>
    <div id='ledstatus'><b>Mode</b></div>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","idle")'       ontouchstart='sendCommand("mode","idle")'>Idle</button>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","mow")'      ontouchstart='sendCommand("mode","mow")'>Mow</button>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","once")'     ontouchstart='sendCommand("mode","once")'>Mow once</button>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","charge")'      ontouchstart='sendCommand("mode","charge")'>Charge</button>
    <br />
    <div class=mower-stats>
      <span class="single-stats"></span><span class="stats-name">Battery</span><span class="stats-value" id="BatteryVoltage">-</span>V</span></span>
      <span class="single-stats"></span><span class="stats-name">Tilt</span><span class="stats-value" id="Tilt">-</span>&deg;</span></span>
      <span class="single-stats"></span><span class="stats-name">Heading</span><span class="stats-value" id="Heading"></span>&deg;</span></span>
      <span class="single-stats"></span><span class="stats-name">Left</span><span class="stats-value" id="LeftMotorSpeed">-</span>/<span class="stats-value" id="LeftMotorLoad">-</span></span></span>
      <span class="single-stats"></span><span class="stats-name">Right</span><span class="stats-value" id="RightMotorSpeed">-</span>/<span class="stats-value" id="RightMotorLoad">-</span></span></span>
      <span class="single-stats"></span><span class="stats-name">Cutter</span><span class="stats-value" id="CutterMotorSpeed">-</span>/<span class="stats-value" id="CutterMotorLoad">-</span></span></span>
      <span class="single-stats"></span><span class="stats-name">Docked</span><span class="stats-value" id="IsDocked">-</span></span></span>
      <span class="single-stats"></span><span class="stats-name">Sensors</span><span class="stats-value" id="LeftSensor">-</span>/<span class="stats-value" id="RightSensor">-</span></span></span>
      <span class="single-stats"></span><span class="stats-name">OpMode</span><span class="stats-value" id="OpMode">-</span></span></span>
      <span class="single-stats"></span><span class="stats-name">Behavior</span><span class="stats-value" id="Behavior">-</span></span></span>
    </div>
    <div class='log'>
      <div><b>Log</b></div>
      <div class='log-content' id='log'>
      </div>
      <div style="clear:both"></div>
    </div>
  </div>
</body>
</html>