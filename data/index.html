<!DOCTYPE html>
<html>
<head>
<meta name = 'viewport' content = 'width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable=0'>
<title>Liang</title>
<link rel="stylesheet" href="style.css">
<script
  src="https://code.jquery.com/jquery-3.6.0.slim.js"
  integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
  crossorigin="anonymous"></script>
<script type='text/javascript'>
var websock;
function start()
{
/*  if (websock) {
    websock.close();
  }*/

  websock = new WebSocket('ws://' + window.location.hostname + '/ws');
  websock.onopen = function(evt) { console.log('websock open'); };
  websock.onclose = function(e) {
    console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
    websock = undefined;
    setTimeout(function() {
      start();
    }, 1000);
  };

  websock.onerror = function(err) {
    console.error('Socket encountered error: ', err.message, 'Closing socket');
    websock.close();
  };  
  websock.onmessage = function(evt) {
    let el = $("#log")
    el.append(`<p class='log-row'>${evt.data}</p>`);

    el[0].scrollTop = el[0].scrollHeight;
  };
}
function buttonclick(e)
{
  websock.send(e.id);
}

function sendCommand(component, value) {
  /*if (!websock) {
    start();
  }*/
  let msg = `${component}_${value}`;
  console.log(msg);
  websock.send(msg);
}

</script>
</head>
<body onload='javascript:start();'>
  <div class='container'> 
    <h1>Liang</h1>
    <div id='ledstatus'><b>Mode</b></div>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","idle")'       ontouchstart='sendCommand("mode","idle")'>Idle</button>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","mow")'      ontouchstart='sendCommand("mode","mow")'>Mow</button>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","once")'     ontouchstart='sendCommand("mode","once")'>Mow once</button>
    <button class='navbutton' type='button' onmousedown='sendCommand("mode","charge")'      ontouchstart='sendCommand("mode","charge")'>Charge</button>
    <br />
    <div class='log'>
      <div><b>Log</b></div>
      <div class='log-content' id='log'>
      </div>
      <div style="clear:both"></div>
    </div>
  </div>
</body>
</html>